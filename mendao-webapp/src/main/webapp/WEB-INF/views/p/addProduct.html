<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8"></meta>
<meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
<meta name="renderer" content="webkit"></meta>
<!--360浏览器优先以webkit内核解析-->
<title>后台管理 - 代理产品添加</title>
<link th:href="@{${cdn} + '/css/bootstrap.min.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/font-awesome.min.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/plugins/iCheck/custom.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/animate.min.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/plugins/webuploader/webuploader.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/demo/webuploader-demo.min.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/css/style.css'}" rel="stylesheet"></link>
<link rel="stylesheet" th:href="@{/js/plugins/kindeditor/themes/default/default.css}" />
<script th:src="@{${cdn} + '/js/jquery.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/bootstrap.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/plugins/layer/layer.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/content.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/welcome.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/jqPaginator.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/jquery.validate.min.js'}" type="text/javascript"></script>
    <script th:src="@{${cdn} + '/js/additional-methods.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/js/common.js'}" type="text/javascript"></script>
<link th:href="@{${cdn} + '/diyUpload/css/webuploader.css'}" rel="stylesheet"></link>
<link th:href="@{${cdn} + '/diyUpload/css/diyUpload.css'}" rel="stylesheet"></link>
<script th:src="@{${cdn} + '/diyUpload/js/webuploader.html5only.min.js'}" type="text/javascript"></script>
<script th:src="@{${cdn} + '/diyUpload/js/diyUpload.js'}" type="text/javascript"></script>
<style type="text/css">
checkbox: {
	background: rgb(255, 255, 255);
	margin: 0px;
	padding: 0px;
	border: 0px;
	border-image: none;
	left: 0%;
	top: 0%;
	width: 100%;
	height: 100%;
	display: block;
	position: absolute;
	opacity: 0;
}
</style>
</head>

<body class="fixed-sidebar gray-bg"> 
	<div id="wrapper">
        <div th:include="layout/common/home-left"></div>
        <!--左侧导航结束-->
        <!--右侧部分开始-->
        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                    <div class="navbar-header">
                    	<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#">
                    		<i class="fa fa-bars"></i> 
                    	</a>
                    </div>
                </nav>
            </div>
            <div class="row J_mainContent" id="content-main">
            	<div class="wrapper wrapper-content">
        <form th:action="@{/dproduct/addProduct}" method="post" id="addProductForm"
            class="form-horizontal">
            <div class="modal-header">
                <h4 class="modal-title">添加新产品</h4>
            </div>
            <div class="modal-body modal-pad">
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">产品名称<span
                        class="form-required"> * </span>:
                    </label>
                    <div class="col-sm-9">
                        <input class="form-control product-dic" placeholder="名称"
                            name="pName" value="" id="pName" type="text" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">产品描述<span
                        class="form-required"> * </span>:
                    </label>
                    <div class="col-sm-9">
                        <textarea class="form-control product-dic" placeholder="描述"
                            name="desc"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">价格<span class="form-required"> * </span>:</label>
                    <div class="col-sm-9">
                        <input class="form-control product-dic" placeholder="价格" name="price" id="price"/>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">产品状态<span
                        class="form-required"> * </span>:
                    </label>
                    <div class="col-sm-9">
                        <select name="status">
                            <option value="1">上架</option>
                            <option value="0">下架</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">视频介绍:</label>
                    <div class="col-sm-9">
                        <input class="form-control product-dic" placeholder="视频介绍" name="videoUrl" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label"></label>
                    <div class="col-sm-9">
                        <span style="color:red;margin-left:5px;">添加视频介绍，需要带http://的网址</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">产品属性<span
                        class="form-required"> * </span>:
                    </label>
                    <div class="col-sm-9">
                        <ul class="product-ul" style="list-style: none" id="kind_list">
                            <li th:each="properties : ${pageBean}" style="float: left; margin-right: 10px">
                                <span th:text="${properties.kindName}"></span>
                                <input class="i-radios" type="radio" name="kindId" th:value="${properties.id}" />
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label"></label>
                    <div class="col-sm-9">
                        <button type="button" class="btn btn-primary" onclick="addKind()" >添加属性</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label">产品图片:</label>
                    <div class="col-sm-9">
                        <div id="uploadButton" ></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="acc-name" class="col-sm-3 control-label"></label>
                    <div class="col-sm-9">
                        <ul id="agent_product_img">
                            
                        </ul>
                    </div>
                </div>
                <div class="form-group">
                    <div id="errorTip" class="toast">
                        <span></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a class="btn btn-primary" style="margin-left: 30px;"
                    th:href="@{'/dproduct/list/-1'}">取消</a>
                <button type="submit" class="btn btn-primary">保存</button>
            </div>
        </form>
    </div>
            <div class="footer">
                <div class="pull-right">
                	&copy; 2016 
                </div>
            </div>
        </div>
    </div>
</div>
	<script th:inline="javascript">
        /*<![CDATA[*/
        	$(document).ready(function(){
				//添加新产品时校验
		    	$("#addProductForm").validate({
					rules : {
						pName : {
							required : true,
							isNull : true,
							minlength : 2,
							maxlength : 20
						},
						price : {
							required : true,
							isNull : true,
							minlength : 2,
							maxlength : 20
						}
					},
					messages : {
						pName : {
							required : "请输入产品名称",
							isNull :"请输入产品名称",
							minlength : "产品名称最少为2个字符",
							maxlength : "产品名称最多为20个字符"
						},
						price : {
							required : "请输入价格",
							isNull :"请输入价格",
							minlength : "价格最少为2个字符",
							maxlength : "价格最多为20个字符"
						}
					},
					errorElement : "em",
					errorPlacement : function(error, element) {
						// 向错误信息添加'help-block'样式
						error.addClass("help-block");
						if (element.prop("type") === "checkbox") {
							error.insertAfter(element.parent("label"));
						} else {
							error.insertAfter(element);
						}
					},
					highlight : function(element, errorClass,validClass) {
						$(element).parents(".form-group").addClass("has-error").removeClass("has-success");
					},
					unhighlight : function(element, errorClass,validClass) {
						$(element).parents(".form-group").addClass("has-success").removeClass("has-error");
					}
				});
		    	
			});
	        $('#uploadButton').diyUpload({
	        	url: /*[[@{'/upload/upmanyimage?dir=image'}]]*/,
	        	chunked:true,
	        	// 分片大小
	        	chunkSize:512 * 1024,
	        	//最大上传的文件数量, 总文件大小,单个文件大小(单位字节);
	        	fileNumLimit:50,
	        	fileSizeLimit:50 * 1024 * 1024,
	        	fileSingleSizeLimit:50 * 1024 * 1024,
	        	success:function( data ) {
	        		if (data.error === 0) {
						var html = '<li><div class="product-img"><div class="pull-left"><img class="img-responsive center-block" width="200px" height="200px" src="'+ data.url+'" /><input type="hidden" name="productImage" value="'+data.path+'" /></div>';
						html += '<div class="pull-left"><span class="glyphicon glyphicon-remove-circle del-img"></span></div><div class="clearfix"></div></div></li>';
						var num = $("#agent_product_img li").length;
						if(num > 0){
							$("#agent_product_img li:last-child").after(html);
						}else{
							$("#agent_product_img").html(html);
						}
						$(".fileBoxUl").html("");
						$(".del-img").on("click",function(){
			        		$(this).parent("div").parent("div").parent("li").remove();
			        	});
					} else {
						alert(data.message);
					}
	        	},
	        	error:function( err ) {
	        		console.info( err );	
	        	}
	        });
        function addKind(){
        	layer.prompt({
        	  title: '添加标签',
        	  formType: 0 //prompt风格，支持0-2
        	}, function(message, index){
        		$.post(
        				/*[[@{'/dproduct/addPKindAjax'}]]*/,
        				{'kindName' : message},
       					function (data) {
       						if(data.status === 1){
       							layer.close(index);
       							var html = "<li style='float: left; margin-right: 10px'><span>"+data.name+"</span><input class='i-radios' type='radio' name='kindId' value='"+data.id+"' /></li>"
       							$("#kind_list li:last").after(html);
       						}else{
       							layer.alert(data.message,{icon: 2}, function(index){
    								  	layer.close(index);
    								});
       						}
       					}
       				);
        	});
        }
	    /*]]>*/
    </script>
</body>
</html>