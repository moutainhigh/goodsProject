<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="renderer" content="webkit"></meta>
    <title th:if="${#strings.isEmpty(shopMessage.shopName)}">店铺</title>
    <title th:if="${shopMessage.shopName}" th:inline="text">[[${shopMessage.shopName}]]</title>
    <link th:href="@{${cdn} + '/css/font-awesome/css/font-awesome.min.css'}" rel="stylesheet"></link>
    <link th:href="@{${cdn} + '/css/index.css'}" rel="stylesheet"></link>
    <link th:href="@{${cdn} + '/css/new-style.css'}" rel="stylesheet"></link>
	<script th:src="@{${cdn} + '/js/zepto.min.js'}" type="text/javascript"></script>
	<script th:src="@{${cdn} + '/js/iscroll-probe.js'}" type="text/javascript"></script>
</head>
<body class="index">
	<!--
       	作者：lp
       	时间：2016-08-09
       	描述：导航栏
       -->
       <div class="wapper" id="container">
		<div class="scroll">
			<div class="search" >
				<div class="avator" >
					<img th:src="@{${cdn}+'/img/avator.png'}" />
				</div>
				<div class="search-bar" >
					<div class="search-bar-div" >
						<div class="store-name" >
							店铺名称
						</div>
						<div class="search-right" >
							<input type="text" class="form-control" id="p_name"/>
							<i class="fa fa-search search-icon" onclick="searchData()"></i>
						</div>
						<div class="clearfix"></div>
					</div>
					<p class="mt5" >相遇是恩泽一场，始终在做重复的两件 事诚信以及坚持。</p>
				</div>
			</div>
			<div class="select-div">
				<div>
					<form role="form">
					    <select class="form-control"> 
					      <option>价格</option> 
					      <option>20</option> 
					      <option>30</option> 
					      <option>40</option> 
					      <option>50</option> 
					    </select>
					</form>    
				</div>
				<div>
					<form role="form">
					    <select class="form-control"> 
					      <option th:each="list,kindStat : ${kindList}" th:inline="text" th:alt="${list.kindName}">[[${list.kindName}]]</option> 
					    </select>
					</form>    
				</div>
				<div>
					<form role="form">
					    <select class="form-control"> 
					      <option>是否倒计时</option> 
					      <option>20分钟</option> 
					      <option>30分钟</option> 
					      <option>40分钟</option> 
					      <option>50分钟</option> 
					    </select>
					</form>    
				</div>
			</div> 
			<div class="pad10 goods-list pic-content" >
				<ul >
					
				</ul>
				<div class="pull">
	                <div class="pull-text" id="pull_text_up">上拉浏览更多</div>
	                <div class="infinite-scroll-preloader" id="scroller-pullUp">
	                    <div class="preloader"></div>
	                </div>
	             </div>
			</div>	
		</div>
	</div>		
	<script th:inline="javascript">
	/*<![CDATA[*/
		var myScroll = null;
		var page = 1;
		var userInfo = userInfo || {};
		var allVote = {};
		
		function renderList(data) {
			$('.pull-text').show();
         	$('#scroller-pullUp').hide();
			if (data.length <= 0 ) {
	         	$('.pull-text').html('没有更多数据~~');
               	$('.pull-text').addClass('no-data');
	        }else{
	        	if($('.pic-content ul li').length > 0){
					$('.pic-content ul li:last-child').after(data);	
				}else{
					$('.pic-content ul').html(data);
				}
				var imgW=$(window).width()*0.5-15;
	    		$(".pro-item-img").height(imgW*1.3);//设置产品图的高度
				if (myScroll)myScroll.refresh();
	        }
			initeDownTime();
		}
		
		function pageList(page) {
			//var kindId = $(".buttun-check").attr("alt");
			var pName = $("#p_name").val();
			if (pName == "") { 
				$.ajax({
					url: /*[[@{'/front/fproduct/getItem/'+${id}}]]*/,
					type: 'get',
					dataType: 'text',
					data: { 'curpage':page },
					success: function(res) {
						renderList(res);
					},
					error: function(res) {}
				});
			}else{
				$.ajax({
					url: /*[[@{'/front/fproduct/getItem/'+${id}}]]*/,
					type: 'get',
					dataType: 'text',
					data: { 'curpage':page,'pName':pName },
					success: function(res) {
						renderList(res);
					},
					error: function(res) {}
				});
			}
		}
		
		$(document).ready(function() {
			pageList(page);
			
			var uy = 0;
	        myScroll = new IScroll('#container', {
	            probeType: 3,
	            tap: true,
	            click: true,
	            mouseWheel: true,
	            scrollbars: true,
	            fadeScrollbars: true,
	            interactiveScrollbars: false,
	            keyBindings: false,
	            deceleration: 0.0002
	        });
	        myScroll.on('scrollStart', function() {
	            uy = this.y;
	        });
	
	        myScroll.on('scroll', function() {
	            var y = this.y - uy;
	        });
	
	        myScroll.on('scrollEnd', function() {
	            if (!$('.pull-text').hasClass('no-data')) {
	                $('.pull-text').hide();
	                $('#scroller-pullUp').show();
	                if (myScroll)myScroll.refresh();
	                page++;
	                pageList(page);
	            } else {
	                $('.pull-text').html('没有更多数据~~');
	            }
	        });
		});
		
		//初始化倒计时
		function initeDownTime(){
		 	$("input[name='downTime']").each(function(index){
		        var NowTime = new Date();
		        var t = $(this).val() - NowTime.getTime();
		        var time = "";
		        if(t>0){
			        var h=Math.floor(t/1000/60/60%24);
			        var m=Math.floor(t/1000/60%60);
			        var s=Math.floor(t/1000%60);
			        if(h < 10){
			        	time+="0"+h+":";
			        }else{
			        	time+=h+":";
			        }
			        if(m < 10){
			        	time+="0"+m+":";
			        }else{
			        	time+=m+":";
			        }
			        if(s < 10){
			        	time+="0"+s;
			        }else{
			        	time+=s;
			        }
		        }else{
		        	time = "00:00:00";
		        }
		        $(this).prev().html(time);
            }); 
		}
		//每一秒倒计时一次
		setInterval(initeDownTime,1000);
		
		function searchList(data){
			$('.pic-content ul').html(data);
			var imgW=$(window).width()*0.5-15;
    		$(".pro-item-img").height(imgW*1.3);//设置产品图的高度
		}
		function searchData(){
			var pName = $("#p_name").val();
			page=1;
			if (pName == "") { 
				$.ajax({
					url: /*[[@{'/front/fproduct/getItem/'+${id}}]]*/,
					type: 'get',
					dataType: 'text',
					data: { 'curpage':page },
					success: function(res) {
						searchList(res);
					},
					error: function(res) {}
				});
			}else{
				$.ajax({
					url: /*[[@{'/front/fproduct/getItem/'+${id}}]]*/,
					type: 'get',
					dataType: 'text',
					data: { 'curpage':page,'pName':pName },
					success: function(res) {
						searchList(res);
					},
					error: function(res) {}
				});
			}
		}
	/*]]>*/
	</script>
</body>
</html>